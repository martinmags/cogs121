<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Prompts</title>
  <link rel="stylesheet" href="css/cssreset.css">
  <link rel="stylesheet" href="css/prompt.css">
  <script src="./js/jquery-3.4.1.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-firestore.js"></script>

  <!-- <script src="./js/displayImages.js"></script> -->

  <script>
    // Initialize Cloud Firestore through Firebase
    firebase.initializeApp({
      apiKey: "AIzaSyC6FPXu3_bOHpHr7AelgBKAMbGiIUPZ2Vo",
      authDomain: "pandaexpressjs.firebaseapp.com",
      projectId: "pandaexpressjs"
    });

    var db = firebase.firestore();   
     
    // extract promptId from URL params
    function getUrlVars() {
      var vars = {};
      var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {
        vars[key] = value;
      });
      return vars;
    }

    let pid = getUrlVars()["pid"];
    console.log("pid: " + pid);

    window.onload = function () {
      document.getElementById("pid").value = pid;
      db.collection("prompts").doc(pid).onSnapshot(doc => {
        const sid = doc.data().submissions;
        sid.forEach((sid)=> {
          db.collection("submissions").doc(sid).onSnapshot(doc =>{
            db.collection("submissions").get().then((querySnapshot) => {
              const imgsrc = doc.data().file;
              console.log(imgsrc);
              let tgtContainer = document.querySelector(".submitted_container");

              querySnapshot.forEach((doc) => {
                tgtContainer.innerHTML += `
                    <img class="image" alt="submission" src="${imgsrc}"></text>
                `
              })



            });            
          });
        });
        
      });


    }
  </script>
</head>

<body>
  <div class="screen_container">

    <div class="top_container">
      <a id="back-button" href="Discover.html">BACK</a>
      <div class="header_container">
        <div class="blur-box"></div>
        <header id="header-title">Prompt Title</header>
      </div>
    </div>

    <div class="time_remaining_container">
      <text id="time">Time remaining: 2 days 3 hrs 20 secs</text>
    </div>

    <div class="button_container">
      <form action="/pass-prompt" method="POST">
        <input type="hidden" id="pid" name="promptId">
        <input id="btn" type="submit" value="Submit my work">
      </form>
      <!-- <a href="Submission.html">
        <button id="btn">Submit my work</button>
      </a> -->
    </div>

    <div class="submitted_header_container">
      <text id="submitted_header">Submitted Work</text>
      <text id="submitted_description">Evaluate any work below</text>
    </div>

    <div class="submitted_container">
    </div>
    
  </div>
</body>

</html>

</html>